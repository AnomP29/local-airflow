name: local-airflow-actions

on: # specify the build to trigger the automated ci/cd
    push:
        branches:
            - "main"
        tags: [ v* ]
# env: 
#   REGISTRY: docker.io
#   IMAGE_NAME: ${{ github.repository }}


run-name: running tests for buildimage
jobs:
    build:
        name: Build Docker-Image
        runs-on: ubuntu-latest
        steps:
            - # checkout to the repository on the build machine
              name: Checkout
              uses: actions/checkout@v3
            - # login to Docker Hub using the secrets provided
              name: Login to Docker Hub
              run: echo ${{ secrets.DOCKERHUB_TOKEN }} | docker login -u ${{ secrets.DOCKERHUB_USERNAME }} --password-stdin
              # uses: docker/login-action@v2
              # with:
              #   username: ${{ env.USERNAME }}
              #   password: ${{ env.PASSWORD }}
            
            - name: Extract metadata for the Docker image
              id: meta
              uses: docker/metadata-action@98669ae865ea3cffbcbaa878cf57c20bbf1c6c38
              with:
                images: docker.io/anompu/airflow-293-hub:latest
                tags: |
                    type=semver,pattern={{version}}


            - # create a build kit builder instance
              name: Set up Docker Buildx
              uses: docker/setup-buildx-action@v2
            - # build the container image and push it to Docker \
              # Hub with the name clockbox.
              name: Build and push
              uses: docker/build-push-action@v4
              with:
                context: .
                file: ./Dockerfile
                push: true
                tags: ${{ steps.meta.outputs.tags }}
                labels: ${{ steps.meta.outputs.labels }}



              

